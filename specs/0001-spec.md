# 产品需求文档 (PRD)

## Excalidraw 桌面编辑器

### 1. 产品概述

#### 1.1 产品名称

Excalidraw 桌面编辑器 (ExcaliApp)

#### 1.2 产品定位

一款基于 Tauri 框架开发的免费桌面应用程序，专注于本地 Excalidraw 文件的管理和编辑。为用户提供简洁、高效的 Excalidraw 图表编辑体验。

#### 1.3 目标用户

- 个人用户：需要在本地管理和编辑 Excalidraw 图表文件
- 设计师：使用 Excalidraw 进行草图和原型设计
- 开发者：使用 Excalidraw 绘制架构图和流程图
- 学生和教师：使用 Excalidraw 制作教学图表

#### 1.4 核心价值

- **本地化管理**：直接管理本地文件系统中的 Excalidraw 文件
- **快速切换**：在多个文件间快速切换，提高工作效率
- **自动保存**：编辑内容自动保存，防止数据丢失
- **原生体验**：基于 Tauri 提供接近原生的桌面应用体验

### 2. 功能需求

#### 2.1 目录管理

##### 2.1.1 目录选择

- **功能描述**：用户可以选择一个包含 Excalidraw 文件的目录
- **交互流程**：
  1. 应用启动时，如果之前未选择过目录，显示目录选择对话框
  2. 如果之前已选择过目录，自动加载上次选择的目录
  3. 用户可通过菜单或快捷键重新选择目录
- **技术要求**：
  - 使用 Tauri 的文件系统 API 进行目录选择
  - 在本地存储中记录最近使用的目录路径

##### 2.1.2 记忆功能

- **功能描述**：应用记住用户上次打开的目录
- **实现细节**：
  - 使用 Tauri 的本地存储功能保存目录路径
  - 启动时自动读取并加载保存的目录

#### 2.2 文件列表（侧边栏）

##### 2.2.1 文件显示

- **功能描述**：在侧边栏显示选定目录下的所有 Excalidraw 文件
- **显示规则**：
  - 仅显示 `.excalidraw` 扩展名的文件
  - 按文件名字母顺序排列
  - 显示文件名（不含扩展名）
- **视觉设计**：
  - 侧边栏宽度：250-300px
  - 可调整宽度（可选功能）
  - 文件项高度：32-40px
  - 包含文件图标

##### 2.2.2 文件状态指示

- **功能描述**：显示文件的编辑状态
- **状态类型**：
  - 当前选中：高亮显示
  - 已修改未保存：显示标记（如红点）
  - 正常状态：默认样式

##### 2.2.3 文件刷新

- **功能描述**：监听目录变化，自动更新文件列表
- **触发条件**：
  - 新增文件
  - 删除文件
  - 文件重命名

#### 2.3 文件编辑

##### 2.3.1 文件加载

- **功能描述**：点击侧边栏文件，在主编辑区加载并显示文件内容
- **技术实现**：
  - 使用 Excalidraw SDK 加载文件数据
  - 在主编辑区渲染 Excalidraw 编辑器

##### 2.3.2 编辑功能

- **功能描述**：提供完整的 Excalidraw 编辑功能
- **包含功能**：
  - 绘制形状（矩形、圆形、菱形、线条、箭头）
  - 文本编辑
  - 颜色选择
  - 图层管理
  - 缩放和平移
  - 撤销/重做

##### 2.3.3 自动保存

- **功能描述**：编辑内容自动保存到本地文件
- **保存策略**：
  - 切换文件时自动保存当前文件
  - 定时保存（每30秒）
  - 用户手动保存（Ctrl+S / Cmd+S）
- **保存提示**：
  - 保存成功时显示简短提示
  - 保存失败时显示错误信息

#### 2.4 文件切换

##### 2.4.1 快速切换

- **功能描述**：点击侧边栏其他文件快速切换
- **切换逻辑**：
  1. 检查当前文件是否有未保存的修改
  2. 如有修改，自动保存
  3. 加载新选择的文件
  4. 更新编辑区显示

##### 2.4.2 键盘快捷键

- **功能描述**：支持键盘快捷键切换文件
- **快捷键方案**：
  - Ctrl+Tab / Cmd+Tab：切换到下一个文件
  - Ctrl+Shift+Tab / Cmd+Shift+Tab：切换到上一个文件

#### 2.5 菜单栏

##### 2.5.1 菜单结构

- **功能描述**：提供原生应用菜单栏，支持常用操作
- **菜单项设计**：

**文件菜单**：
- 打开目录 (Ctrl+O / Cmd+O) - 选择新的工作目录
- 新建文件 (Ctrl+N / Cmd+N) - 在当前目录创建新的 Excalidraw 文件
- 保存 (Ctrl+S / Cmd+S) - 手动保存当前文件
- 另存为 (Ctrl+Shift+S / Cmd+Shift+S) - 将当前文件另存到其他位置
- 最近打开的目录 - 显示最近使用的目录列表（最多10个）
- 退出 (Ctrl+Q / Cmd+Q) - 退出应用程序

**编辑菜单**：
- 撤销 (Ctrl+Z / Cmd+Z) - 撤销上一步操作
- 重做 (Ctrl+Y / Cmd+Shift+Z) - 重做操作
- 剪切 (Ctrl+X / Cmd+X) - 剪切选中内容
- 复制 (Ctrl+C / Cmd+C) - 复制选中内容
- 粘贴 (Ctrl+V / Cmd+V) - 粘贴内容

**视图菜单**：
- 切换侧边栏 (Ctrl+B / Cmd+B) - 显示/隐藏文件列表侧边栏
- 放大 (Ctrl++ / Cmd++) - 放大编辑区
- 缩小 (Ctrl+- / Cmd+-) - 缩小编辑区
- 重置缩放 (Ctrl+0 / Cmd+0) - 恢复默认缩放
- 全屏 (F11 / Cmd+Ctrl+F) - 进入/退出全屏模式

**窗口菜单**：
- 最小化 (Ctrl+M / Cmd+M) - 最小化窗口
- 关闭窗口 (Ctrl+W / Cmd+W) - 关闭当前窗口

**帮助菜单**：
- 快捷键列表 - 显示所有快捷键
- 关于 ExcaliApp - 显示应用版本和信息

##### 2.5.2 实现要求

- **技术实现**：
  - 使用 Tauri 的原生菜单 API 创建系统菜单
  - 菜单项根据操作系统自动适配（Windows/macOS/Linux）
  - 支持快捷键绑定和状态管理
- **交互细节**：
  - 菜单项根据当前状态动态启用/禁用
  - 最近目录列表动态更新
  - 保存相关操作在有未保存修改时高亮提示

### 3. 界面设计

#### 3.1 整体布局

- **布局结构**：左右分栏布局
  - 左侧：文件列表侧边栏（固定宽度或可调整）
  - 右侧：Excalidraw 编辑器主区域
- **响应式设计**：
  - 最小窗口宽度：1600px
  - 最小窗口高度：900px

#### 3.2 颜色方案

- **主题支持**：
  - 浅色主题（默认）
  - 深色主题
  - 跟随系统主题

#### 3.3 交互反馈

- **视觉反馈**：
  - 鼠标悬停效果
  - 点击效果
  - 加载动画
- **操作反馈**：
  - 保存成功提示
  - 错误提示
  - 加载进度

### 4. 技术架构

#### 4.1 技术栈

- **框架**：Tauri 2.x
- **前端**：
  - React 19.x
  - TypeScript
  - Excalidraw SDK
  - TailwindCSS / shadcn/ui
- **后端**：Rust (Tauri 后端)

#### 4.2 数据存储

- **文件存储**：直接操作本地文件系统
- **配置存储**：使用 Tauri 的本地存储 API
- **存储内容**：
  - 最近打开的目录路径
  - 用户偏好设置（主题等）
  - 窗口大小和位置

#### 4.3 性能要求

- **启动时间**：< 1秒
- **文件加载**：< 500ms（中等大小文件）
- **自动保存**：< 100ms
- **内存占用**：< 200MB（空闲状态）

### 5. 非功能需求

#### 5.1 可用性

- **易用性**：界面简洁直观，无需学习成本
- **快捷键**：支持常用快捷键操作
- **错误处理**：友好的错误提示和恢复机制

#### 5.2 可靠性

- **数据安全**：
  - 自动保存防止数据丢失
  - 文件操作前创建备份（可选）
- **稳定性**：
  - 异常处理机制
  - 崩溃恢复

#### 5.3 兼容性

- **操作系统支持**：
  - Windows 10/11
  - macOS 10.15+
  - Linux (Ubuntu 20.04+)
- **文件格式**：完全兼容 Excalidraw 官方格式

### 6. 开发计划

#### 6.1 第一阶段（MVP）

- 目录选择和记忆功能
- 文件列表显示
- 基础文件编辑功能
- 文件切换和自动保存

#### 6.2 第二阶段（增强）

- 键盘快捷键支持
- 主题切换
- 文件搜索功能
- 性能优化

#### 6.3 第三阶段（扩展）

- 文件导出功能（PNG、SVG）
- 最近文件列表
- 多标签页支持
- 插件系统

### 7. 成功指标

#### 7.1 用户体验指标

- 应用启动时间 < 2秒
- 文件切换响应时间 < 500ms
- 零数据丢失率

#### 7.2 技术指标

- 代码测试覆盖率 > 70%
- 无严重bug
- 内存占用稳定

### 8. 风险和限制

#### 8.1 技术风险

- Excalidraw SDK 版本更新可能导致兼容性问题
- Tauri 框架的限制可能影响某些功能实现

#### 8.2 限制条件

- 仅支持本地文件，不提供云同步功能
- 不支持多用户协作
- 不支持文件版本管理

### 9. 附录

#### 9.1 参考资源

- Excalidraw 官方文档：<https://docs.excalidraw.com>
- Tauri 官方文档：<https://tauri.app>
- 设计稿位置：./images/excaliapp.jpg

#### 9.2 术语说明

- **Excalidraw**：一个开源的手绘风格图表绘制工具
- **Tauri**：一个使用 Web 技术构建原生桌面应用的框架
- **MVP**：最小可行产品（Minimum Viable Product）
